<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaktivn칤 mapa budovy</title>
    <style>
        /* Kontejner pro SVG */
        #projectsvg {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 177.78%;
            /* Pom캩r stran pro v칳코ku 1920px a 코칤콏ku 1080px */
            vertical-align: middle;
            margin: 0;
            overflow: hidden;
        }

        /* Nov칳 styl pro progress bar container */
        .progress-container {
            position: fixed;
            bottom: 65px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }

        /* Styl pro samotn칳 progress bar */
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 5px;
        }

        /* Progress text */
        .progress-text {
            text-align: center;
            margin-top: 5px;
            font-size: 12px;
            color: #333;
        }


        /* SVG pro pozad칤 */
        #projectsvg svg {
            display: inline-block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* Inicialn칤 stav interaktivn칤ch oblast칤 */
        .hover_group {
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }

        /* Styly pro ozna캜en칤 oblast칤 */
        .zone {
            fill: rgba(255, 165, 0, 0.6);
            /* Oran쬺v치 barva */
            cursor: pointer;
            transition: fill 0.3s ease;
        }

        /* Ztmaven칤 z칩ny p콏i najet칤 */
        .zone:hover {
            fill: rgba(255, 165, 0, 0.8);
            /* Ztmaven칤 p콏i najet칤 */
        }

        /* Nov칳 styl pro hotov칠 z칩ny */
        .zone.completed {
            fill: rgba(0, 255, 0, 0.6);
            /* Zelen치 barva pro hotov칠 */
        }

        .zone.completed:hover {
            fill: rgba(0, 255, 0, 0.8);
        }

        /* Styl pro texty v oblastech */
        text {
            fill: white;
            pointer-events: none;
        }

        .title {
            font-size: 20px;
            font-weight: bold;
        }

        .description {
            font-size: 14px;
            font-weight: normal;
        }

        /* Stylov치n칤 vyhled치vac칤 li코ty */
        .search-bar {
            position: fixed;
            bottom: 20px;
            /* P콏esun na spodn칤 캜치st obrazovky */
            left: 50%;
            transform: translateX(-50%);
            background-color: white;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            z-index: 10;
        }

        /* Zv칳razn캩n칤 vybran칠 z칩ny */
        .highlight {
            fill: rgba(255, 0, 0, 0.3);
            border: 2px solid red;
        }

        /* Pulzuj칤c칤 or치mov치n칤 */
        @keyframes pulseBorder {
            0% {
                fill: rgba(255, 0, 0, 0.5);
                /* Za캜치tek - 캜erven칠 */
            }

            50% {
                fill: rgba(0, 255, 0, 0.5);
                /* Polovina animace - zelen칠 */
            }

            100% {
                fill: rgba(0, 0, 255, 0.5);
                /* Konec - modr칠 */
            }
        }

        .zone.pulsing {
            animation: pulseBorder 1s ease-in-out infinite;
            /* Pulzuj칤c칤 efekt */
            border: 4px solid;
            /* Or치mov치n칤 */
            border-radius: 8px;
            /* Zaoblen칠 rohy (voliteln칠) */
        }
    </style>
</head>

<body>

    <!-- Nov칳 progress bar -->
    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
        <div class="progress-text">0 / 0 spln캩n칳ch z칩n</div>
    </div>

    <div class="search-bar">
        <select id="zoneSelect">
            <option value="">-- Vyberte z칩nu --</option>
            <!-- Dynamicky generovan칠 mo쬹osti -->
        </select>
    </div>

    <figure id="projectsvg">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
            viewBox="0 0 1080 1920" preserveAspectRatio="xMinYMin meet">
            <image width="1080" height="1920" xlink:href="mapa.png" />
        </svg>
    </figure>

    <script>
        const zones = [
            { x: 850, y: 897, width: 230, height: 50, title: "BI", description: "Prezentace biologick칠ho krou쬶u", room: "PBI, LBI", link: "#", code: "1234", type: "default" },
            { x: 170, y: 900, width: 170, height: 50, title: "ZSV", description: "Neurov캩deck치 laborato콏", room: "U4D", link: "#", code: "5678", type: "default" },
            { x: 143, y: 70, width: 230, height: 50, title: "BI", description: "Fantastick치 zv칤콏ata", room: "BAD", link: "#", code: "9012", type: "default" },
            { x: 170, y: 845, width: 230, height: 50, title: "ZSV", description: "Vyn치lezy a sou캜asn칳 sv캩t", room: "U1C", link: "#", code: "3456", type: "default" },
            { x: 900, y: 1650, width: 300, height: 50, title: "TV", description: "Biomechanika ve sportu", room: "T캩v", link: "#", code: "7890", type: "default" },
            { x: 789.5, y: 1360, width: 230, height: 50, title: "FY", description: "Chladniho obrazce", room: "LFY", link: "#", code: "1111", type: "default" },
            { x: 666.5, y: 1300, width: 330, height: 50, title: "FY", description: "Experimenty barona Pr치코ila", room: "PFY", link: "#", code: "2222", type: "default" },
            { x: 143, y: 15, width: 230, height: 50, title: "FY", description: "캛idla Vernier", room: "BAD", link: "#", code: "3333", type: "default" },
            { x: 830, y: 60, width: 230, height: 50, title: "HV", description: "Hudebn칤 aktivity", room: "HV1", link: "#", code: "4444", type: "default" },
            { x: 681.5, y: 890.5, width: 110, height: 50, title: "NJ", description: "Jazykov칠 칰koly", room: "J2", link: "#", code: "5555", type: "default" },
            { x: 700, y: 40, width: 230, height: 50, title: "MAT", description: "Maty치코 Sandorf", room: "U3C", link: "#", code: "6666", type: "default" },
            { x: 423.5, y: 835, width: 230, height: 50, title: "FJ", description: "Mal칳 princ", room: "U5A", link: "#", code: "7777", type: "default" },
            { x: 522.5, y: 892, width: 135, height: 50, title: "AJ", description: "Kv칤zy o vyn치lezc칤ch", room: "J1", link: "#", code: "8888", type: "default" },
            { x: 50, y: 600, width: 80, height: 50, title: "IT", description: "L칠t치n칤 s drony", room: "U3A", link: "#", code: "9999", type: "default" },
            { x: 5, y: 360, width: 130, height: 50, title: "IT", description: "Microbit a 3D tisk", room: "U3D", link: "#", code: "0000", type: "default" },
            { x: 900, y: 410, width: 90, height: 50, title: "RJ", description: "Harry Potter", room: "J4", link: "#", code: "1357", type: "default" },
            { x: 50, y: 1550, width: 120, height: 50, title: "CH", description: "Barevn치 chemie", room: "LCH", link: "#", code: "2468", type: "default" },
            { x: 150, y: 1380, width: 100, height: 50, title: "CH", description: "Fluorescence", room: "PCH", link: "#", code: "1234", type: "default" },
            { x: 500, y: 700, width: 230, height: 50, title: "캛J", description: "Filmov칠 adaptace", room: "", link: "#", code: "5678", type: "default" },
            { x: 900, y: 220, width: 230, height: 50, title: "De", description: "V칳stavka verneovek", room: "kabDE", link: "#", code: "9012", type: "default" },
            { x: 350, y: 1300, width: 230, height: 50, title: "AJ/ZE", description: "Gymn치zium na cest치ch", room: "U2D", link: "#", code: "3456", type: "default" },
            { x: 400, y: 200, width: 230, height: 50, title: "VV", description: "Karel Zeman", room: "ATV", link: "#", code: "7890", type: "default" },
            { x: 600, y: 1360, width: 230, height: 50, title: "Bistro", description: "Francouzsk칠 bistro", room: "U3A", link: "#", code: "1111", type: "default" },
            { x: 460, y: 1360, width: 230, height: 50, title: "Kav치rna", description: "Nejlep코칤 kav치rna", room: "U2A", link: "#", code: "2222", type: "default" },
            { x: 230, y: 1450, width: 230, height: 50, title: "맒ola", description: "Prezentace 코koly", room: "U2C", link: "#", code: "3333", type: "default" },
            { x: 350, y: 1360, width: 230, height: 50, title: "Sbor", description: "P캩veck칳 sbor", room: "U2D", link: "#", code: "4444", type: "default" },
            { x: 930, y: 600, width: 230, height: 50, title: "游늼", description: "P콏ij칤ma캜ky nane캜isto", room: "PZE", link: "#", code: "5555", type: "prijimacky" },
            { x: 750, y: 600, width: 230, height: 50, title: "游늼", description: "P콏ij칤ma캜ky nane캜isto", room: "U4A", link: "#", code: "6666", type: "prijimacky" },
            { x: 630, y: 400, width: 230, height: 50, title: "游늼", description: "P콏ij칤ma캜ky nane캜isto", room: "UTA", link: "#", code: "7777", type: "prijimacky" },
            { x: 530, y: 590, width: 230, height: 50, title: "游늼", description: "P콏ij칤ma캜ky nane캜isto", room: "U6A", link: "#", code: "8888", type: "prijimacky" },
            { x: 340, y: 400, width: 230, height: 50, title: "游늼", description: "P콏ij칤ma캜ky nane캜isto", room: "U1A", link: "#", code: "9999", type: "prijimacky" },
            { x: 160, y: 360, width: 230, height: 50, title: "游늼", description: "P콏ij칤ma캜ky nane캜isto", room: "U3D", link: "#", code: "0000", type: "prijimacky" },
            { x: 160, y: 420, width: 230, height: 50, title: "游늼", description: "P콏ij칤ma캜ky nane캜isto", room: "U4C", link: "#", code: "1357", type: "prijimacky" },
        ];

        // Funkce pro v칳po캜et 코칤콏ky podle d칠lky popisu
        function calculateWidth(description) {
            return Math.min((description.length) * 7 + 20, 330); // Z치kladn칤 코칤콏ka 230 a maxim치ln칤 330
        }

        // Aplikov치n칤 funkce na z칩ny
        zones.forEach(zone => {

            zone.width = calculateWidth(zone.description);

        });

        const svgElement = document.querySelector('svg');
        const zoneSelect = document.getElementById('zoneSelect');
        const progressFill = document.querySelector('.progress-fill');
        const progressText = document.querySelector('.progress-text');

        // Na캜ten칤 stavu hotov칳ch z칩n z localStorage
        let completedZones = JSON.parse(localStorage.getItem('completedZones') || '[]');

        // Inicializace vyhled치vac칤 li코ty
        zones.forEach((zone, index) => {
            if (zone.type !== "prijimacky") { // Vynech치me p콏ij칤ma캜ky
                const option = document.createElement("option");
                option.value = index;
                option.textContent = `${zone.title} - ${zone.description}`;
                zoneSelect.appendChild(option);
            }
        });

        // Funkce pro aktualizaci progress baru
        function updateProgress() {
            const totalZones = zones.filter(zone => zone.type !== "prijimacky").length;
            const completedCount = completedZones.filter(zone => zone.type !== "prijimacky").length;

            const percentage = (completedCount / totalZones) * 100;

            progressFill.style.width = `${percentage}%`;
            progressText.textContent = `${completedCount} / ${totalZones} spln캩n칳ch z칩n`;
        }

        function updateZones() {
            svgElement.innerHTML = '<image width="1080" height="1920" xlink:href="mapa.png" />';
            zones.forEach((zone, index) => {
                const group = document.createElementNS("http://www.w3.org/2000/svg", "g");
                group.classList.add("hover_group");

                const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                rect.classList.add("zone");

                // Nastaven칤 barvy podle typu
                if (zone.type === "prijimacky") {
                    rect.style.fill = "rgba(128, 128, 128, 0.6)"; // 만d치 barva pro p콏ij칤ma캜ky
                    rect.classList.add("unselectable"); // P콏id치me t콏칤du, kterou pak vyu쬴jeme k ov캩콏en칤
                }

                if (completedZones.includes(index)) {
                    rect.classList.add("completed");
                }
                rect.setAttribute("x", zone.x);
                rect.setAttribute("y", zone.y);
                rect.setAttribute("width", zone.width);
                rect.setAttribute("height", zone.height);
                rect.setAttribute("data-index", index);

                // P콏id치n칤 click event listeneru pro ozna캜en칤/odzna캜en칤 z칩ny
                if (zone.type != "prijimacky") rect.addEventListener('click', () => toggleZoneCompletion(index));

                const titleText = document.createElementNS("http://www.w3.org/2000/svg", "text");
                titleText.classList.add("title");
                titleText.setAttribute("x", zone.x + zone.width * 0.1);
                titleText.setAttribute("y", zone.y + 20);

                // `tspan` for title
                const titleTspan = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                titleTspan.textContent = zone.title;

                // `tspan` for room with `description` class
                const roomTspan = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                roomTspan.textContent = ` (${zone.room})`;
                roomTspan.classList.add("description");  // Add the 'description' class

                // Append tspans to titleText
                titleText.appendChild(titleTspan);
                titleText.appendChild(roomTspan);

                const descriptionText = document.createElementNS("http://www.w3.org/2000/svg", "text");
                descriptionText.classList.add("description");
                descriptionText.setAttribute("x", zone.x + zone.width * 0.1);
                descriptionText.setAttribute("y", zone.y + 40);
                descriptionText.textContent = zone.description;

                group.appendChild(rect);
                group.appendChild(titleText);
                group.appendChild(descriptionText);

                svgElement.appendChild(group);
            });

            // Aktualizace progress baru p콏i na캜ten칤
            updateProgress();
        }




        function toggleZoneCompletion(index) {
            const zoneElement = document.querySelector(`.zone[data-index="${index}"]`);

            // Nov치 funkce pro zad치n칤 k칩du
            const code = prompt("Zadejte k칩d pro dokon캜en칤 z칩ny:");
            if (code === zones[index].code) { // Ov캩콏en칤 k칩du
                if (completedZones.includes(index)) {
                    // Odzna캜en칤 z칩ny
                    completedZones = completedZones.filter(i => i !== index);
                    zoneElement.classList.remove('completed');
                } else {
                    // Ozna캜en칤 z칩ny
                    completedZones.push(index);
                    zoneElement.classList.add('completed');
                }

                // Ulo쬰n칤 do localStorage
                localStorage.setItem('completedZones', JSON.stringify(completedZones));

                // Aktualizace progress baru p콏i zm캩n캩
                updateProgress();
            } else {
                alert("Zadali jste nespr치vn칳 k칩d.");
            }
        }

        function highlightZone(index) {
            document.querySelectorAll('.zone').forEach(zone => zone.classList.remove('highlight'));
            // Odstran캩n칤 pulzuj칤c칤ho or치mov치n칤 u v코ech z칩n
            document.querySelectorAll('.zone').forEach(zone => zone.classList.remove('pulsing'));
            const selectedZone = document.querySelector(`.zone[data-index="${index}"]`);
            if (selectedZone) {
                selectedZone.classList.add('highlight');
                selectedZone.scrollIntoView({ behavior: "smooth", block: "center", inline: "center" });
                selectedZone.classList.add('pulsing'); // P콏id치n칤 pulzuj칤c칤ho or치mov치n칤
            }
        }

        zoneSelect.addEventListener('change', (event) => {
            const selectedIndex = event.target.value;
            if (selectedIndex) {
                highlightZone(selectedIndex);
            }
        });

        updateZones();

        // Detekce, zda se aplikace otev콏ela v intern칤m prohl칤쬰캜i Messengeru
        function isInMessengerBrowser() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            return /FBAN|FBAV/.test(userAgent);
        }

        // Funkce pro p콏esm캩rov치n칤 na norm치ln칤 webov칳 prohl칤쬰캜
        function redirectToNormalBrowser() {
            // Z칤sk치n칤 aktu치ln칤 URL adresy
            const currentUrl = window.location.href;

            // P콏esm캩rov치n칤 na aktu치ln칤 URL adresu, ale v norm치ln칤m webov칠m prohl칤쬰캜i
            window.location.replace(`${currentUrl}`);
        }

        // Kontrola, zda se aplikace otev콏ela v Messengeru a p콏칤padn칠 p콏esm캩rov치n칤
        if (isInMessengerBrowser()) {
            redirectToNormalBrowser();
        }
    </script>

</body>

</html>
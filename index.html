<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaktivn√≠ mapa budovy</title>
    <style>
        /* Kontejner pro SVG */
        #projectsvg {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 177.78%;
            /* Pomƒõr stran pro v√Ω≈°ku 1920px a ≈°√≠≈ôku 1080px */
            vertical-align: middle;
            margin: 0;
            overflow: hidden;
        }

        /* Nov√Ω styl pro progress bar container */
        .progress-container {
            position: fixed;
            bottom: 65px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }

        /* Styl pro samotn√Ω progress bar */
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 5px;
        }

        /* Progress text */
        .progress-text {
            text-align: center;
            margin-top: 5px;
            font-size: 12px;
            color: #333;
        }


        /* SVG pro pozad√≠ */
        #projectsvg svg {
            display: inline-block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* Inicialn√≠ stav interaktivn√≠ch oblast√≠ */
        .hover_group {
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }

        /* Styly pro oznaƒçen√≠ oblast√≠ */
        .zone {
            fill: rgba(255, 165, 0, 0.6);
            /* Oran≈æov√° barva */
            cursor: pointer;
            transition: fill 0.3s ease;
        }

        /* Ztmaven√≠ z√≥ny p≈ôi najet√≠ */
        .zone:hover {
            fill: rgba(255, 165, 0, 0.8);
            /* Ztmaven√≠ p≈ôi najet√≠ */
        }

        /* Nov√Ω styl pro hotov√© z√≥ny */
        .zone.completed {
            fill: rgba(0, 255, 0, 0.6);
            /* Zelen√° barva pro hotov√© */
        }

        .zone.completed:hover {
            fill: rgba(0, 255, 0, 0.8);
        }

        /* Styl pro texty v oblastech */
        text {
            fill: white;
            pointer-events: none;
        }

        .title {
            font-size: 20px;
            font-weight: bold;
        }

        .description {
            font-size: 14px;
            font-weight: normal;
        }

        /* Stylov√°n√≠ vyhled√°vac√≠ li≈°ty */
        .search-bar {
            position: fixed;
            bottom: 20px;
            /* P≈ôesun na spodn√≠ ƒç√°st obrazovky */
            left: 50%;
            transform: translateX(-50%);
            background-color: white;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            z-index: 10;
        }

        /* Zv√Ωraznƒõn√≠ vybran√© z√≥ny */
        .highlight {
            fill: rgba(255, 0, 0, 0.3);
            border: 2px solid red;
        }

        /* Pulzuj√≠c√≠ or√°mov√°n√≠ */
        @keyframes pulseBorder {
            0% {
                fill: rgba(255, 0, 0, 0.5);
                /* Zaƒç√°tek - ƒçerven√© */
            }

            50% {
                fill: rgba(0, 255, 0, 0.5);
                /* Polovina animace - zelen√© */
            }

            100% {
                fill: rgba(0, 0, 255, 0.5);
                /* Konec - modr√© */
            }
        }

        .zone.pulsing {
            animation: pulseBorder 1s ease-in-out infinite;
            /* Pulzuj√≠c√≠ efekt */
            border: 4px solid;
            /* Or√°mov√°n√≠ */
            border-radius: 8px;
            /* Zaoblen√© rohy (voliteln√©) */
        }
    </style>
</head>

<body>

    <!-- Nov√Ω progress bar -->
    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
        <div class="progress-text">0 / 0 splnƒõn√Ωch z√≥n</div>
    </div>

    <div class="search-bar">
        <select id="zoneSelect">
            <option value="">-- Vyberte z√≥nu --</option>
            <!-- Dynamicky generovan√© mo≈ænosti -->
        </select>
    </div>

    <figure id="projectsvg">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
            viewBox="0 0 1080 1920" preserveAspectRatio="xMinYMin meet">
            <image width="1080" height="1920" xlink:href="mapa.png" />
        </svg>
    </figure>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>
    <script>
        const zones = [
            { x: 450, y: 1550, width: 230, height: 50, title: "START / C√çL", description: "Zde zaƒç√≠n√° hra! Z√≠skej prvn√≠ k√≥d.", room: "Vestibul", link: "#", code: "3267", type: "default" },
            { x: 850, y: 897, width: 230, height: 50, title: "BI", description: "Prezentace biologick√©ho krou≈æku", room: "PBI, LBI", link: "#", code: "4721", type: "default" },
            { x: 170, y: 900, width: 170, height: 50, title: "ZSV", description: "Neurovƒõdeck√° laborato≈ô", room: "U4D", link: "#", code: "5863", type: "default" },
            { x: 143, y: 70, width: 230, height: 50, title: "BI", description: "Fantastick√° zv√≠≈ôata", room: "BAD", link: "#", code: "9124", type: "default" },
            { x: 170, y: 845, width: 230, height: 50, title: "ZSV", description: "Vyn√°lezy a souƒçasn√Ω svƒõt", room: "U1C", link: "#", code: "3485", type: "default" },
            { x: 789.5, y: 1360, width: 230, height: 50, title: "FY", description: "Chladniho obrazce", room: "LFY", link: "#", code: "1122", type: "default" },
            { x: 666.5, y: 1300, width: 330, height: 50, title: "FY", description: "Experimenty barona Pr√°≈°ila", room: "PFY", link: "#", code: "2389", type: "default" },
            { x: 830, y: 60, width: 230, height: 50, title: "HV", description: "Hudebn√≠ aktivity", room: "HV1", link: "#", code: "4789", type: "default" },
            { x: 681.5, y: 890.5, width: 110, height: 50, title: "NJ", description: "Jazykov√© √∫koly", room: "J2", link: "#", code: "5594", type: "default" },
            { x: 700, y: 40, width: 230, height: 50, title: "MAT", description: "Maty√°≈° Sandorf", room: "U3C", link: "#", code: "6672", type: "default" },
            { x: 423.5, y: 892, width: 230, height: 50, title: "FJ", description: "Mal√Ω princ", room: "U5A", link: "#", code: "7891", type: "default" },
            { x: 522.5, y: 892, width: 135, height: 50, title: "AJ", description: "Kv√≠zy o vyn√°lezc√≠ch", room: "J1", link: "#", code: "8119", type: "default" },
            { x: 50, y: 600, width: 80, height: 50, title: "IT", description: "L√©t√°n√≠ s drony", room: "U1D", link: "#", code: "9203", type: "default" },
            { x: 5, y: 360, width: 130, height: 50, title: "IT", description: "Microbit a 3D tisk", room: "U3D", link: "#", code: "1456", type: "default" },
            { x: 900, y: 410, width: 90, height: 50, title: "RJ", description: "Harry Potter", room: "J4", link: "#", code: "1379", type: "default" },
            { x: 50, y: 1550, width: 120, height: 50, title: "CH", description: "Barevn√° chemie", room: "LCH", link: "#", code: "2458", type: "default" },
            { x: 150, y: 1380, width: 100, height: 50, title: "CH", description: "Fluorescence", room: "PCH", link: "#", code: "3524", type: "default" },
            { x: 750, y: 1080, width: 230, height: 50, title: "ƒåJ", description: "Filmov√© adaptace", room: "U8A", link: "#", code: "5947", type: "default" },
            { x: 900, y: 220, width: 230, height: 50, title: "De", description: "V√Ωstavka verneovek", room: "kabDE", link: "#", code: "9735", type: "default" },
            { x: 350, y: 1300, width: 230, height: 50, title: "AJ/ZE", description: "Gymn√°zium na cest√°ch", room: "U2D", link: "#", code: "3164", type: "default" },
            { x: 400, y: 200, width: 230, height: 50, title: "VV", description: "Karel Zeman", room: "ATV", link: "#", code: "7402", type: "default" },
            { x: 600, y: 1360, width: 230, height: 50, title: "Bistro", description: "Francouzsk√© bistro", room: "U3A", link: "#", code: "1716", type: "default" },
            { x: 460, y: 1360, width: 230, height: 50, title: "Kav√°rna", description: "Nejlep≈°√≠ kav√°rna", room: "U2A", link: "#", code: "2273", type: "default" },
            { x: 350, y: 1360, width: 230, height: 50, title: "Sbor", description: "Pƒõveck√Ω sbor", room: "U2D", link: "#", code: "4915", type: "prijimacky" },
            { x: 230, y: 1450, width: 230, height: 50, title: "≈†kola", description: "Prezentace ≈°koly", room: "U2C", link: "#", code: "3819", type: "prijimacky" },
            { x: 930, y: 600, width: 230, height: 50, title: "üìë", description: "P≈ôij√≠maƒçky naneƒçisto", room: "PZE", link: "#", code: "5896", type: "prijimacky" },
            { x: 750, y: 600, width: 230, height: 50, title: "üìë", description: "P≈ôij√≠maƒçky naneƒçisto", room: "U4A", link: "#", code: "6275", type: "prijimacky" },
            { x: 630, y: 400, width: 230, height: 50, title: "üìë", description: "P≈ôij√≠maƒçky naneƒçisto", room: "UTA", link: "#", code: "7136", type: "prijimacky" },
            { x: 530, y: 590, width: 230, height: 50, title: "üìë", description: "P≈ôij√≠maƒçky naneƒçisto", room: "U6A", link: "#", code: "8462", type: "prijimacky" },
            { x: 340, y: 400, width: 230, height: 50, title: "üìë", description: "P≈ôij√≠maƒçky naneƒçisto", room: "U1A", link: "#", code: "9351", type: "prijimacky" },
            { x: 160, y: 360, width: 230, height: 50, title: "üìë", description: "P≈ôij√≠maƒçky naneƒçisto", room: "U3D", link: "#", code: "1248", type: "prijimacky" },
            { x: 160, y: 420, width: 230, height: 50, title: "üìë", description: "P≈ôij√≠maƒçky naneƒçisto", room: "U1D", link: "#", code: "2384", type: "prijimacky" },
        ];


        // Funkce pro v√Ωpoƒçet ≈°√≠≈ôky podle d√©lky popisu
        function calculateWidth(description) {
            return Math.min((description.length) * 7 + 20, 330); // Z√°kladn√≠ ≈°√≠≈ôka 230 a maxim√°ln√≠ 330
        }

        // Aplikov√°n√≠ funkce na z√≥ny
        zones.forEach(zone => {

            zone.width = calculateWidth(zone.description);

        });

        const svgElement = document.querySelector('svg');
        const zoneSelect = document.getElementById('zoneSelect');
        const progressFill = document.querySelector('.progress-fill');
        const progressText = document.querySelector('.progress-text');

        // Naƒçten√≠ stavu hotov√Ωch z√≥n z localStorage
        let completedZones = JSON.parse(localStorage.getItem('completedZones') || '[]');

        // Inicializace vyhled√°vac√≠ li≈°ty
        zones.forEach((zone, index) => {
            if (zone.type !== "prijimacky") { // Vynech√°me p≈ôij√≠maƒçky
                const option = document.createElement("option");
                option.value = index;
                option.textContent = `${zone.title} - ${zone.description}`;
                zoneSelect.appendChild(option);
            }
        });

        // Funkce pro aktualizaci progress baru
        function updateProgress() {
            const totalZones = zones.filter(zone => zone.type !== "prijimacky").length;
            const completedCount = completedZones.filter(zone => zone.type !== "prijimacky").length;

            const percentage = (completedCount / totalZones) * 100;

            progressFill.style.width = `${percentage}%`;
            progressText.textContent = `${completedCount} / ${totalZones} splnƒõn√Ωch z√≥n`;
        }

        function updateZones() {
            svgElement.innerHTML = '<image width="1080" height="1920" xlink:href="mapa.png" />';
            zones.forEach((zone, index) => {
                const group = document.createElementNS("http://www.w3.org/2000/svg", "g");
                group.classList.add("hover_group");

                const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                rect.classList.add("zone");

                // Nastaven√≠ barvy podle typu
                if (zone.type === "prijimacky") {
                    rect.style.fill = "rgba(128, 128, 128, 0.6)"; // ≈†ed√° barva pro p≈ôij√≠maƒçky
                    rect.classList.add("unselectable"); // P≈ôid√°me t≈ô√≠du, kterou pak vyu≈æijeme k ovƒõ≈ôen√≠
                }

                if (completedZones.includes(index)) {
                    rect.classList.add("completed");
                }
                rect.setAttribute("x", zone.x);
                rect.setAttribute("y", zone.y);
                rect.setAttribute("width", zone.width);
                rect.setAttribute("height", zone.height);
                rect.setAttribute("data-index", index);

                // P≈ôid√°n√≠ click event listeneru pro oznaƒçen√≠/odznaƒçen√≠ z√≥ny
                if (zone.type != "prijimacky") rect.addEventListener('click', () => toggleZoneCompletion(index));

                const titleText = document.createElementNS("http://www.w3.org/2000/svg", "text");
                titleText.classList.add("title");
                titleText.setAttribute("x", zone.x + zone.width * 0.1);
                titleText.setAttribute("y", zone.y + 20);

                // `tspan` for title
                const titleTspan = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                titleTspan.textContent = zone.title;

                // `tspan` for room with `description` class
                const roomTspan = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                roomTspan.textContent = ` (${zone.room})`;
                roomTspan.classList.add("description");  // Add the 'description' class

                // Append tspans to titleText
                titleText.appendChild(titleTspan);
                titleText.appendChild(roomTspan);

                const descriptionText = document.createElementNS("http://www.w3.org/2000/svg", "text");
                descriptionText.classList.add("description");
                descriptionText.setAttribute("x", zone.x + zone.width * 0.1);
                descriptionText.setAttribute("y", zone.y + 40);
                descriptionText.textContent = zone.description;

                group.appendChild(rect);
                group.appendChild(titleText);
                group.appendChild(descriptionText);

                svgElement.appendChild(group);
            });

            // Aktualizace progress baru p≈ôi naƒçten√≠
            updateProgress();
        }




        function toggleZoneCompletion(index) {
            const zoneElement = document.querySelector(`.zone[data-index="${index}"]`);

            const code = prompt("Zadejte k√≥d pro dokonƒçen√≠ z√≥ny:");

            if (code !== null) {
                if (code === zones[index].code) {
                    if (completedZones.includes(index)) {
                        // Odznaƒçen√≠ z√≥ny
                        completedZones = completedZones.filter(i => i !== index);
                        zoneElement.classList.remove('completed');
                    } else {
                        // Oznaƒçen√≠ z√≥ny
                        completedZones.push(index);
                        zoneElement.classList.remove('pulsing');
                        zoneElement.classList.add('completed');

                        // Spu≈°tƒõn√≠ konfet
                        startConfetti();
                    }

                    // Ulo≈æen√≠ do localStorage
                    localStorage.setItem('completedZones', JSON.stringify(completedZones));

                    // Aktualizace progress baru p≈ôi zmƒõnƒõ
                    updateProgress();
                } else {
                    alert("Zadali jste nespr√°vn√Ω k√≥d.");
                }
            }
        }

        // Funkce pro spu≈°tƒõn√≠ konfet na 5 sekund
        function startConfetti() {
            const duration = 2500; // D√©lka v milisekund√°ch
            const end = Date.now() + duration;

            // Funkce pro generov√°n√≠ konfet
            (function frame() {
                confetti({
                    particleCount: 5,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 }
                });
                confetti({
                    particleCount: 5,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 }
                });

                // Pokraƒçuj, dokud ƒças nevypr≈°√≠
                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            })();
        }



        function highlightZone(index) {
            document.querySelectorAll('.zone').forEach(zone => zone.classList.remove('highlight'));
            // Odstranƒõn√≠ pulzuj√≠c√≠ho or√°mov√°n√≠ u v≈°ech z√≥n
            document.querySelectorAll('.zone').forEach(zone => zone.classList.remove('pulsing'));
            const selectedZone = document.querySelector(`.zone[data-index="${index}"]`);
            if (selectedZone) {
                selectedZone.classList.add('highlight');
                selectedZone.scrollIntoView({ behavior: "smooth", block: "center", inline: "center" });
                selectedZone.classList.add('pulsing'); // P≈ôid√°n√≠ pulzuj√≠c√≠ho or√°mov√°n√≠
            }
        }

        zoneSelect.addEventListener('change', (event) => {
            const selectedIndex = event.target.value;
            if (selectedIndex) {
                highlightZone(selectedIndex);
            }
        });

        updateZones();

        // Funkce pro detekci, zda se aplikace otev≈ôela v intern√≠m prohl√≠≈æeƒçi Messengeru
        function isInMessengerBrowser() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            return /FBAN|FBAV/.test(userAgent);
        }

        // Funkce pro zobrazen√≠ alertu s v√Ωzvou k otev≈ôen√≠ v norm√°ln√≠m prohl√≠≈æeƒçi
        function showNormalBrowserAlert() {
            alert("Pro nejlep≈°√≠ z√°≈æitek otev≈ôete tuto aplikaci v norm√°ln√≠m webov√©m prohl√≠≈æeƒçi. V prohl√≠≈æeƒçi od messengeru nebo jin√©m podobn√©m nemus√≠ fungovat dob≈ôe interakce. Chrome, Safari, Mozilla by mƒõly b√Ωt ok.");
        }

        // Kontrola, zda se aplikace otev≈ôela v Messengeru a zobrazen√≠ alertu
        if (isInMessengerBrowser()) {
            showNormalBrowserAlert();
        }
    </script>

</body>

</html>